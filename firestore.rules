rules_version = '2';

service cloud.firestore {
  match /databases/{database}/documents {

    // Allow new users to sign up by creating a club and their own user documents.
    // This rule is intentionally open for the sign-up process.
    match /clubs/{clubId} {
      allow create: if true; // Anyone can create a club.

      // Once a club is created, only authenticated users belonging to that club can interact with it.
      // This part of the rules assumes you have a way to check if a user belongs to a club.
      // We'll build on this later. For now, let's focus on sign-up.

      match /users/{userId} {
        allow create: if true; // Allow creation of user doc within the club
      }

      match /settings/{settingId} {
         allow create: if true; // Allow creation of settings doc within the club
      }
    }

    match /users/{userId} {
       allow create: if request.auth != null && request.auth.uid == userId;
    }

    // Default deny all other reads/writes
    match /{document=**} {
      allow read, write: if false;
    }
  }
}
